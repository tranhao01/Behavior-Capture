<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ AI Behavioral Analyst - API Integration</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f7fa; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .api-config { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .section { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; }
        textarea { height: 300px; font-family: monospace; font-size: 13px; }
        .buttons { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        button { padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
        .btn-sample { background: #f3f4f6; color: #374151; }
        .btn-analyze { background: #2563eb; color: white; }
        .btn-copy { background: #059669; color: white; }
        button:hover { transform: translateY(-1px); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .error { background: #fef2f2; color: #dc2626; padding: 10px; border-radius: 6px; margin-top: 10px; }
        .success { background: #f0fdf4; color: #16a34a; padding: 10px; border-radius: 6px; margin-top: 10px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ AI Behavioral Analyst - API Integration</h1>
            <p>Ph√¢n t√≠ch h√†nh vi ng∆∞·ªùi d√πng v·ªõi OpenAI GPT ho·∫∑c Google Gemini</p>
        </div>
        
        <div class="api-config">
            <h2>‚öôÔ∏è C·∫•u h√¨nh API</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr 2fr; gap: 10px; align-items: end;">
                <select id="apiProvider">
                    <option value="openai">OpenAI GPT</option>
                    <option value="gemini">Google Gemini</option>
                </select>
                <input type="password" id="apiKey" placeholder="API Key">
                <div class="buttons" style="margin-top: 0;">
                    <button class="btn-sample" onclick="testConnection()">üîó Test Connection</button>
                    <button class="btn-copy" onclick="showApiGuide()">üìñ H∆∞·ªõng d·∫´n API</button>
                </div>
            </div>
            <div id="connectionStatus"></div>
        </div>
        
        <div class="grid">
            <div class="section">
                <h2>üìä D·ªØ li·ªáu ƒë·∫ßu v√†o</h2>
                <textarea id="inputData" placeholder="Nh·∫≠p d·ªØ li·ªáu JSON..."></textarea>
                <div class="buttons">
                    <button class="btn-sample" onclick="loadSample()">D√πng d·ªØ li·ªáu m·∫´u</button>
                    <button class="btn-analyze" onclick="analyzeWithAI()" id="analyzeBtn">ü§ñ Ph√¢n t√≠ch v·ªõi AI</button>
                </div>
            </div>
            
            <div class="section">
                <h2>ü§ñ K·∫øt qu·∫£ ph√¢n t√≠ch</h2>
                <textarea id="result" readonly placeholder="K·∫øt qu·∫£ AI s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y..."></textarea>
                <div class="buttons">
                    <button class="btn-copy" onclick="copyResult()">üìã Copy K·∫øt qu·∫£</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SAMPLE_DATA = {
            event: "Add to Cart",
            event_attributes: {
                product_id: "SKU12345",
                category: "Shoes",
                quantity: 2,
                price: 450000,
                channel: "Facebook Ads",
                timestamp: "2025-09-14T16:45:00Z"
            },
            user_attributes: {
                user_id: "U001",
                device: "Mobile iOS",
                location: "HCMC, VN",
                language: "vi",
                purchase_history: [
                    { order_id: "O101", value: 1200000, date: "2025-07-21" },
                    { order_id: "O102", value: 800000, date: "2025-08-10" }
                ]
            }
        };

        const SYSTEM_PROMPT = `B·∫°n l√† chuy√™n gia ph√¢n t√≠ch h√†nh vi ng∆∞·ªùi d√πng, tu√¢n th·ªß b·∫£o m·∫≠t & ph√°p l√Ω.
Nhi·ªám v·ª•: nh·∫≠n d·ªØ li·ªáu s·ª± ki·ªán (event logs) v√† h·ªì s∆° ng∆∞·ªùi d√πng (user profile) ƒë·ªÉ ph√¢n t√≠ch h√†nh vi.
Lu√¥n t√°ch ri√™ng 2 nh√≥m thu·ªôc t√≠nh: (1) Event Attributes, (2) User Attributes.
Lu√¥n l√†m r√µ: (a) h√†nh vi hi·ªán t·∫°i, (b) xu h∆∞·ªõng/cluster, (c) nguy c∆°/churn, (d) c∆° h·ªôi c√° nh√¢n h√≥a.
ƒê·∫ßu ra ph·∫£i c√≥: Summary ‚Üí Ph√¢n t√≠ch chi ti·∫øt ‚Üí Khuy·∫øn ngh·ªã.
Kh√¥ng g√°n nh√£n t√≠nh c√°ch c·ª©ng, ch·ªâ ƒë∆∞·ª£c ƒë∆∞a ra x√°c su·∫•t ho·∫∑c segment h√†nh vi.
Kh√¥ng suy di·ªÖn v·ªÅ quan h·ªá x√£ h·ªôi tr·ª´ khi c√≥ d·ªØ li·ªáu quan h·ªá ƒë∆∞·ª£c cung c·∫•p.
Lu√¥n n√™u gi·ªõi h·∫°n & ƒë·ªô tin c·∫≠y c·ªßa ph√¢n t√≠ch.

Tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng JSON v·ªõi format:
{
  "summary": "T√≥m t·∫Øt ng·∫Øn g·ªçn",
  "analysis": {
    "current_behavior": "H√†nh vi hi·ªán t·∫°i",
    "trend": "Xu h∆∞·ªõng/cluster",
    "risk": "Nguy c∆° churn",
    "opportunity": "C∆° h·ªôi c√° nh√¢n h√≥a"
  },
  "recommendation": ["Khuy·∫øn ngh·ªã 1", "Khuy·∫øn ngh·ªã 2"],
  "limitations": "Gi·ªõi h·∫°n ph√¢n t√≠ch"
}`;

        function loadSample() {
            document.getElementById('inputData').value = JSON.stringify(SAMPLE_DATA, null, 2);
        }

        async function testConnection() {
            const provider = document.getElementById('apiProvider').value;
            const apiKey = document.getElementById('apiKey').value;
            const statusDiv = document.getElementById('connectionStatus');
            
            if (!apiKey) {
                statusDiv.innerHTML = '<div class="error">Vui l√≤ng nh·∫≠p API Key</div>';
                return;
            }

            statusDiv.innerHTML = '<div>ƒêang test connection...</div>';

            try {
                if (provider === 'openai') {
                    const response = await fetch('https://api.openai.com/v1/models', {
                        headers: { 'Authorization': `Bearer ${apiKey}` }
                    });
                    if (response.ok) {
                        statusDiv.innerHTML = '<div class="success">‚úÖ OpenAI API k·∫øt n·ªëi th√†nh c√¥ng!</div>';
                    } else {
                        statusDiv.innerHTML = '<div class="error">‚ùå OpenAI API Key kh√¥ng h·ª£p l·ªá</div>';
                    }
                } else {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                    if (response.ok) {
                        statusDiv.innerHTML = '<div class="success">‚úÖ Gemini API k·∫øt n·ªëi th√†nh c√¥ng!</div>';
                    } else {
                        statusDiv.innerHTML = '<div class="error">‚ùå Gemini API Key kh√¥ng h·ª£p l·ªá</div>';
                    }
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="error">‚ùå L·ªói k·∫øt n·ªëi: ' + error.message + '</div>';
            }
        }

        async function analyzeWithAI() {
            const provider = document.getElementById('apiProvider').value;
            const apiKey = document.getElementById('apiKey').value;
            const inputData = document.getElementById('inputData').value;
            const resultArea = document.getElementById('result');
            const analyzeBtn = document.getElementById('analyzeBtn');

            if (!apiKey) {
                alert('Vui l√≤ng nh·∫≠p API Key v√† test connection tr∆∞·ªõc');
                return;
            }

            if (!inputData.trim()) {
                alert('Vui l√≤ng nh·∫≠p d·ªØ li·ªáu ƒë·ªÉ ph√¢n t√≠ch');
                return;
            }

            try {
                JSON.parse(inputData);
            } catch (e) {
                alert('D·ªØ li·ªáu JSON kh√¥ng h·ª£p l·ªá');
                return;
            }

            analyzeBtn.textContent = 'üîÑ ƒêang ph√¢n t√≠ch...';
            analyzeBtn.disabled = true;
            resultArea.value = 'ƒêang g·ª≠i request ƒë·∫øn AI...';

            try {
                let result;
                if (provider === 'openai') {
                    result = await callOpenAI(apiKey, inputData);
                } else {
                    result = await callGemini(apiKey, inputData);
                }
                
                resultArea.value = result;
            } catch (error) {
                resultArea.value = `L·ªói: ${error.message}`;
            } finally {
                analyzeBtn.textContent = 'ü§ñ Ph√¢n t√≠ch v·ªõi AI';
                analyzeBtn.disabled = false;
            }
        }

        async function callOpenAI(apiKey, inputData) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [
                        { role: 'system', content: SYSTEM_PROMPT },
                        { role: 'user', content: `Ph√¢n t√≠ch d·ªØ li·ªáu sau:\n${inputData}` }
                    ],
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'OpenAI API error');
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callGemini(apiKey, inputData) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `${SYSTEM_PROMPT}\n\nPh√¢n t√≠ch d·ªØ li·ªáu sau:\n${inputData}`
                        }]
                    }]
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'Gemini API error');
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        function copyResult() {
            const result = document.getElementById('result').value;
            if (result) {
                navigator.clipboard.writeText(result);
                alert('K·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c copy!');
            }
        }

        function showApiGuide() {
            alert(`üîë H∆∞·ªõng d·∫´n l·∫•y API Key:

OpenAI:
1. Truy c·∫≠p: https://platform.openai.com/api-keys
2. ƒêƒÉng nh·∫≠p v√† t·∫°o API key m·ªõi
3. Copy key v√† paste v√†o √¥ API Key

Google Gemini:
1. Truy c·∫≠p: https://makersuite.google.com/app/apikey
2. T·∫°o API key m·ªõi
3. Copy key v√† paste v√†o √¥ API Key

‚ö†Ô∏è L∆∞u √Ω: API key s·∫Ω ƒë∆∞·ª£c l∆∞u trong tr√¨nh duy·ªát, kh√¥ng g·ª≠i ƒë·∫øn server n√†o kh√°c.`);
        }

        // Load sample data on page load
        window.onload = () => loadSample();
    </script>
</body>
</html>